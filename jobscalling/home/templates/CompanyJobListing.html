<!DOCTYPE html>
{% load humanize %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company_name }} | Job Postings</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary-color: #4f46e5; /* Indigo-600 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Very light gray background */
        }
        .job-status-active {
            background-color: #d1fae5; /* Green-100 */
            color: #065f46; /* Green-800 */
        }
        .job-status-inactive {
            background-color: #fee2e2; /* Red-100 */
            color: #991b1b; /* Red-800 */
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8">

    <!-- Main Content Container -->
    <div class="max-w-6xl mx-auto">
        
        <!-- Header and Call to Action -->
        <header class="mb-8 border-b pb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
            <div>
                <h1 class="text-3xl font-extrabold text-gray-900 leading-tight">Your Job Postings</h1>
                <p class="text-gray-500 mt-1">Manage all roles currently advertised by {{ company_name|default:"Your Company" }}.</p>
            </div>
            
            <!-- Link to Post New Job -->
            <a href="{% url 'post_job' %}" 
               class="mt-4 md:mt-0 px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition duration-150 shadow-md flex items-center">
                <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                Post New Job
            </a>
        </header>

        <!-- Message Area (Django Messages) -->
        <!-- Replace this with your actual Django messages block -->
        {# Messages intentionally not shown on the job listing page to keep it focused. #}

        <!-- Search & Filters -->
        <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
            <div class="md:col-span-2">
                <input id="jobSearch" type="text" placeholder="Search jobs, e.g. 'Python, Designer'" 
                       class="w-full p-3 border border-gray-200 rounded-lg shadow-sm" />
            </div>
            <div class="flex gap-3 md:justify-end">
                <select id="filterType" class="p-3 border border-gray-200 rounded-lg">
                    <option value="">All Types</option>
                    <option value="FT">Full-time</option>
                    <option value="PT">Part-time</option>
                    <option value="CT">Contract</option>
                    <option value="IT">Internship</option>
                </select>
                <select id="filterStatus" class="p-3 border border-gray-200 rounded-lg">
                    <option value="">All Statuses</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
        </div>

        <!-- Job List Container -->
        {% if job_list %}
            <div id="jobsContainer" class="space-y-4">
                {% for job in job_list %}
                <!-- Job Card Item -->
                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 border border-gray-100" 
                     data-title="{{ job.title|lower }}" 
                     data-location="{{ job.location|lower }}" 
                     data-type="{{ job.job_type }}" 
                     data-status="{% if job.is_active %}active{% else %}inactive{% endif %}">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-start">
                        
                        <!-- Job Title and Location (Col 1-6) -->
                        <div class="md:col-span-6">
                            <h2 class="text-xl font-bold text-gray-900 hover:text-indigo-600 transition duration-150">
                                <a href="{% url 'job_detail' pk=job.pk %}">{{ job.title }}</a>
                            </h2>
                            <p class="text-gray-500 mt-1 flex items-center">
                                <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                                {{ job.location }}
                            </p>
                            <p class="text-sm text-gray-400 mt-2">Posted: {{ job.posted_date|date:"M d, Y" }}</p>
                            <p class="text-sm text-gray-600 mt-3 line-clamp-3">{{ job.description|truncatechars:180 }}</p>
                        </div>
                        
                        <!-- Job Meta (Col 7-8) -->
                        <div class="md:col-span-2 text-sm text-gray-700">
                            <div class="mb-2"><span class="font-medium">Type</span><div>{{ job.get_job_type_display }}</div></div>
                            <div class="mb-2"><span class="font-medium">Salary</span>
                                <div>
                                    {% if job.min_salary and job.max_salary %}
                                        ${{ job.min_salary|intcomma }} - ${{ job.max_salary|intcomma }}
                                    {% elif job.min_salary %}
                                        From ${{ job.min_salary|intcomma }}
                                    {% elif job.max_salary %}
                                        Up to ${{ job.max_salary|intcomma }}
                                    {% else %}
                                        Not specified
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Status & Applications (Col 9-10) -->
                        <div class="md:col-span-2 flex flex-col items-start md:items-center text-sm">
                            <span class="inline-flex items-center px-3 py-1.5 text-xs font-semibold rounded-full 
                                {% if job.is_active %} job-status-active {% else %} job-status-inactive {% endif %}">
                                <i data-lucide="circle" class="w-3 h-3 mr-1 fill-current"></i>
                                {% if job.is_active %} Active {% else %} Inactive {% endif %}
                            </span>
                            <div class="mt-3 text-gray-600">
                                <div class="text-xs text-gray-500">Applications</div>
                                <div class="font-semibold">{{ job.app_count }}</div>
                            </div>
                        </div>
                        
                        <!-- Actions (Col 11-12) -->
                        <div class="md:col-span-2 flex justify-start md:justify-end space-x-3 mt-3 md:mt-0">
                            <a href="{% url 'job_detail' pk=job.pk %}" 
                               class="text-sm font-semibold text-indigo-600 hover:text-indigo-700 transition duration-150 p-2 rounded-lg hover:bg-indigo-50 flex items-center">
                                <i data-lucide="eye" class="w-4 h-4 mr-1"></i>
                                View
                            </a>
                            <a href="{% url 'post_job' %}?id={{ job.pk }}" 
                               class="text-sm font-semibold text-gray-600 hover:text-gray-700 transition duration-150 p-2 rounded-lg hover:bg-gray-50 flex items-center">
                                <i data-lucide="pencil" class="w-4 h-4 mr-1"></i>
                                Edit
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <!-- Pagination -->
            <div class="mt-6 flex items-center justify-between">
                <div class="text-sm text-gray-600">Showing page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</div>
                <div class="space-x-2">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 rounded-lg border bg-white">Previous</a>
                    {% endif %}
                    {% for num in page_obj.paginator.page_range %}
                        {% if num == page_obj.number %}
                            <span class="px-3 py-1 rounded-lg bg-indigo-600 text-white">{{ num }}</span>
                        {% elif num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
                            <a href="?page={{ num }}" class="px-3 py-1 rounded-lg border bg-white">{{ num }}</a>
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 rounded-lg border bg-white">Next</a>
                    {% endif %}
                </div>
            </div>
            <script>
                // Client-side filtering for quick UX
                (function(){
                    const searchInput = document.getElementById('jobSearch');
                    const typeSelect = document.getElementById('filterType');
                    const statusSelect = document.getElementById('filterStatus');
                    const jobs = Array.from(document.querySelectorAll('#jobsContainer > div'));

                    function filter() {
                        const q = searchInput.value.trim().toLowerCase();
                        const type = typeSelect.value;
                        const status = statusSelect.value;

                        let visible = 0;
                        jobs.forEach(card => {
                            const title = card.dataset.title || '';
                            const location = card.dataset.location || '';
                            const cardType = card.dataset.type || '';
                            const cardStatus = card.dataset.status || '';

                            const matchesQuery = !q || title.includes(q) || location.includes(q);
                            const matchesType = !type || cardType === type;
                            const matchesStatus = !status || cardStatus === status;

                            if (matchesQuery && matchesType && matchesStatus) {
                                card.style.display = '';
                                visible++;
                            } else {
                                card.style.display = 'none';
                            }
                        });

                        // Show empty state if none
                        const empty = document.getElementById('jobsEmptyState');
                        if (empty) empty.style.display = visible === 0 ? 'block' : 'none';
                    }

                    searchInput.addEventListener('input', filter);
                    typeSelect.addEventListener('change', filter);
                    statusSelect.addEventListener('change', filter);
                })();
            </script>
        {% else %}
            <!-- Empty State -->
            <div class="text-center py-16 px-4 bg-white rounded-xl shadow-lg border border-gray-200">
                <i data-lucide="briefcase" class="w-12 h-12 mx-auto text-gray-400 mb-4"></i>
                <h3 class="mt-2 text-lg font-semibold text-gray-900">No Job Postings Yet</h3>
                <p class="mt-1 text-sm text-gray-500">
                    Get started by creating your first job opening to attract top talent.
                </p>
                    <div class="mt-6">
                        <a href="{% url 'post_job' %}"
                           class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Create Job Post
                        </a>
                    </div>
            </div>
        {% endif %}

    </div>

    <script>
        // Initialize lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
